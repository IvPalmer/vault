---
phase: 01-ui-foundation
plan: 05
type: execute
wave: 3
depends_on:
  - "01-01"
  - "01-03"
  - "01-04"
files_modified:
  - FinanceDashboard/dashboard.py
  - FinanceDashboard/components.py
autonomous: false

must_haves:
  truths:
    - "Monthly Overview tab shows transaction table with standardized behavior"
    - "User can perform row actions via three-dot menu (edit, delete, duplicate)"
    - "CSV export button works for current view"
    - "Analytics tab shows charts using all-time data"
    - "Settings tab has functional sub-tabs for configuration"
    - "All tables and dropdowns use the new standardized components"
  artifacts:
    - path: "FinanceDashboard/dashboard.py"
      provides: "Integrated dashboard using all new components"
      contains: "VaultTable"
    - path: "FinanceDashboard/components.py"
      provides: "Updated render functions with row actions and export"
      contains: "export_csv"
  key_links:
    - from: "FinanceDashboard/dashboard.py"
      to: "FinanceDashboard/table_component.py"
      via: "VaultTable usage"
      pattern: "VaultTable"
    - from: "FinanceDashboard/dashboard.py"
      to: "FinanceDashboard/inline_dropdown.py"
      via: "dropdown usage in settings"
      pattern: "InlineDropdown"
---

<objective>
Integrate all new UI components (navigation, tables, dropdowns) into a cohesive dashboard experience and add remaining table features (row actions, export).

Purpose: This plan brings together the navigation restructure (Plan 01), design system (Plan 02), standardized tables (Plan 03), and inline dropdowns (Plan 04) into a fully functional dashboard that meets all Phase 1 requirements.

Output: Complete dashboard with all UI foundation elements working together.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-ui-foundation/01-CONTEXT.md

# Prior plan summaries (dependency context)
@.planning/phases/01-ui-foundation/01-01-SUMMARY.md
@.planning/phases/01-ui-foundation/01-03-SUMMARY.md
@.planning/phases/01-ui-foundation/01-04-SUMMARY.md

# Implementation files
@FinanceDashboard/dashboard.py
@FinanceDashboard/components.py
@FinanceDashboard/table_component.py
@FinanceDashboard/inline_dropdown.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add row actions and CSV export to VaultTable</name>
  <files>FinanceDashboard/table_component.py, FinanceDashboard/components.py</files>
  <action>
Extend VaultTable with row actions and export functionality:

**In table_component.py:**

1. Add action menu column configuration:
```python
def _add_action_column(self, gb):
    """Add three-dot action menu column."""
    if not self.show_actions:
        return

    # AG Grid action menu using custom cell renderer
    action_renderer = JsCode("""
    class ActionRenderer {
        init(params) {
            this.params = params;
            this.eGui = document.createElement('div');
            this.eGui.innerHTML = `
                <button class="action-btn" style="
                    background: none;
                    border: none;
                    cursor: pointer;
                    font-size: 18px;
                    padding: 4px 8px;
                ">...</button>
            `;
        }
        getGui() { return this.eGui; }
    }
    """)

    gb.configure_column(
        '_actions',
        headerName='',
        width=50,
        cellRenderer=action_renderer,
        pinned='right',
        suppressMenu=True,
        sortable=False
    )
```

2. Add export method:
```python
def render_with_export(self):
    """Render table with export button above."""
    col1, col2 = st.columns([4, 1])

    with col2:
        if st.button("Export CSV", key=f"{self.key}_export"):
            self._export_csv()

    return self.render()

def _export_csv(self):
    """Export current dataframe to CSV download."""
    csv = self.df.to_csv(index=False)
    st.download_button(
        label="Download",
        data=csv,
        file_name=f"{self.key}_export.csv",
        mime="text/csv",
        key=f"{self.key}_download"
    )
```

**In components.py:**

3. Update render functions to use render_with_export where appropriate:
- render_cards_grid should have export
- render_recurring_grid should have export
  </action>
  <verify>
Run dashboard:
- Three-dot menu appears on table rows
- Export CSV button appears above tables
- Clicking Export generates downloadable file
  </verify>
  <done>
Tables have row action menus and CSV export capability.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire Settings tab with working sub-tabs</name>
  <files>FinanceDashboard/dashboard.py</files>
  <action>
Complete the Settings tab implementation with functional sub-tabs:

1. Inside the Settings tab, create nested tabs:
```python
with tab_settings:
    st.markdown("## Settings")

    settings_tabs = st.tabs(["Categories", "Rules", "Budgets", "Import"])

    with settings_tabs[0]:  # Categories
        st.markdown("### Category Management")
        # Show current categories with VaultTable
        categories_df = pd.DataFrame([
            {'Category': k, 'Type': v.get('type'), 'Limit': v.get('limit', 0)}
            for k, v in dl_instance.engine.budget.items()
        ])
        cat_table = VaultTable(
            df=categories_df,
            key="settings_categories",
            show_checkbox=False,
            show_actions=True
        )
        cat_table.render()

    with settings_tabs[1]:  # Rules
        st.markdown("### Categorization Rules")
        rules_df = pd.DataFrame([
            {'Keyword': k, 'Category': v}
            for k, v in dl_instance.engine.rules.items()
        ])
        rules_table = VaultTable(
            df=rules_df,
            key="settings_rules",
            show_checkbox=False
        )
        rules_table.render()

    with settings_tabs[2]:  # Budgets
        st.markdown("### Budget Configuration")
        # Move render_fixed_management here
        render_fixed_management(dl_instance, "settings")

    with settings_tabs[3]:  # Import
        st.markdown("### Import Settings")
        st.info("Import configuration coming in future phase.")
```

2. Ensure the nested tabs are visually distinct from main tabs (smaller, secondary styling applied via CSS from Plan 02).

3. Remove any Settings-related content from Monthly Overview that was moved here.
  </action>
  <verify>
Navigate to Settings tab:
- Four sub-tabs visible: Categories, Rules, Budgets, Import
- Each sub-tab shows appropriate content
- Tables in Settings use VaultTable
  </verify>
  <done>
Settings tab has functional sub-tabs for all configuration areas.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete UI Foundation implementation:
- Three-tab navigation (Monthly Overview, Analytics, Settings)
- Month picker in Overview tab
- Standardized tables with sorting, search, selection
- Row action menus and CSV export
- Inline dropdown components
- Cohesive design system with consistent styling
- Settings with nested sub-tabs
  </what-built>
  <how-to-verify>
1. Run: `cd /Users/palmer/Work/Dev/Vault/FinanceDashboard && streamlit run dashboard.py`
2. Verify three main tabs at top: Monthly Overview, Analytics, Settings
3. In Monthly Overview:
   - Month picker works
   - Tables have search boxes
   - Click column headers to sort
   - Amounts show color (green/red) and sign prefix
   - Row actions (three-dot menu) visible
   - Export CSV button works
4. In Analytics:
   - Charts display all-time data
5. In Settings:
   - Four sub-tabs visible: Categories, Rules, Budgets, Import
   - Each sub-tab shows content
   - Nested tabs look visually subordinate to main tabs
6. Overall:
   - Clean, minimalistic design
   - Consistent spacing
   - No cramped layouts
  </how-to-verify>
  <resume-signal>
Type "approved" if all checks pass, or describe issues found.
  </resume-signal>
</task>

</tasks>

<verification>
1. Three-tab navigation works
2. Month picker in Overview controls content
3. All tables use VaultTable with consistent behavior
4. Row actions menu visible on tables
5. CSV export generates downloadable file
6. Settings has working nested tabs
7. Design is clean and consistent throughout
8. All CONTEXT.md specifications met
</verification>

<success_criteria>
- All Phase 1 requirements (UIUX-01, UIUX-02, UIUX-03, UIUX-04) met
- Dashboard has modern, minimalistic visual design
- Inline interactions work (dropdowns in cells)
- Table/grid components are standardized and behave consistently
- Navigation uses tab-based structure
</success_criteria>

<output>
After completion, create `.planning/phases/01-ui-foundation/01-05-SUMMARY.md`
</output>
